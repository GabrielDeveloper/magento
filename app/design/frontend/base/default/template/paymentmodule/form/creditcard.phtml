<?php $_code = $this->getMethodCode(); ?>
<fieldset>
    <ul id="payment_form_<?php echo $_code; ?>" style="display:none;">
        <li>
            <div id="paymentmodule_creditcard">
                <ul >
                    <li style="clear:both">
                        <div class="input-box"  id="tokenDiv" data-mundicheckout-app-id="<?php echo $this->getPublicKey(); ?>">

                            <label for="">Card number<span class="required">*</span></label>
                            <input
                                    type="text"
                                    data-mundicheckout-input="number"
                                    class="required-entry validate-cc-number"
                                    id="mundicheckout-number"
                                    onkeyup="getFormData()"
                                    name="payment[creditCardNumber]"><span data-mundicheckout-brand></span><br>

                            <label for="">Holder name<span class="required">*</span></label>
                            <input
                                    type="text"
                                    data-mundicheckout-input="holder_name "
                                    class="required-entry"
                                    id="mundicheckout-holdername"
                                    onkeyup="getFormData()"
                                    name="payment[holderName]"><br>

                            <label for="">Expiration month<span class="required">*</span></label>
                            <select
                                    class="required-entry"
                                    id="mundicheckout-expmonth"
                                    onchange="getFormData()"
                                    name="payment[creditCardExpMonth]">
                                    <option value="">--- Selecione --- </option>
                                <?php for ($month = 1; $month < 13; $month++ ) { ?>
                                    <option value="<?php echo $month; ?>">
                                        <?php
                                            echo str_pad($month, "2", "0", STR_PAD_LEFT);
                                        ?>
                                    </option>
                                <?php } ?>

                            </select><br>

                            <label for="payment[creditCardExpYear]">Expiration year<span class="required">*</span></label>
                            <select
                                class="required-entry"
                                id="mundicheckout-expyear"
                                onchange="getFormData()"
                                name="payment[creditCardExpYear]">
                                    <option value="">--- Selecione --- </option>
                                <?php for ($year = date("Y"); $year < date("Y") + 11; $year++ ) { ?>
                                    <option value="<?php echo $year; ?>"><?php echo $year; ?></option>
                                <?php } ?>

                            </select><br>

                            <label for="">CVV<span class="required">*</span></label>
                            <input
                                    type="text"
                                    data-mundicheckout-input="cvv"
                                    class="required-entry validate-number validate-cc-cvn"
                                    id="mundicheckout-cvv"
                                    onkeyup="getFormData()"
                                    name="payment[creditCardCvv]"
                                    maxlength="4"
                                    ><br>

                            <input
                                    type="hidden"
                                    id="mundicheckout-token"
                                    class="validate-ajax"
                                    name="payment[creditCardToken]">
                        </div>
                        <p>
                            <div class="validation-advice hidden" id="mundipagg-invalid-credit-card" style="">
                                Cartão de crédito inválido.
                            </div>
                        </p>

                    </li>
                </ul>
            </div>
        </li>
    </ul>
    <script type="javascript">
        Payment.prototype.save = Payment.prototype.save.wrap(function(save) {
            var key = document.getElementById('tokenDiv').getAttribute('data-mundicheckout-app-id');
            var tokenElement = document.getElementById('mundicheckout-token');

            var validator = new Validation(this.form);
            if (this.validate() && validator.validate()) {
                getCreditCardToken(key, function (response) {
                    if (response != false) {
                        tokenElement.value = response.id;
                        jQuery("#mundipagg-invalid-credit-card").hide();
                        save();
                        return;
                    }
                    jQuery("#mundipagg-invalid-credit-card").show();
                });
            }
        });
    </script>
</fieldset>
